{% extends 'layouts/base.html' %}

{% block pageStylesheets %}
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js"></script>
{% endblock pageStylesheets %}

{% block content %}

<span class="govuk-caption-xl">Development plan: {{ development_plan.reference }}</span>
<h1 class="govuk-heading-xl">Area covered by this plan</h1>

<div class="govuk-grid-row">

  <div class="govuk-grid-column-two-thirds">
    <form class="govuk-form" method="POST" action="{{url_for('development_plan.add_geography', reference=development_plan.reference)}}" enctype="multipart/form-data">

      <div class="govuk-form-group">
        <fieldset class="govuk-fieldset">
          <legend class="govuk-fieldset__legend govuk-fieldset__legend--m">
            <h1 class="govuk-fieldset__heading">
              Is the area shown correct?
            </h1>
          </legend>
          <!--{{ geographies }}-->
            {% for org in development_plan.organisations %}
              {% if org.geometry %}
                <div>
                  {% set geojson = geographies[org.organisation].geojson | tojson %}
                  {% set point_x = geographies[org.organisation].lat_long()[0] %}
                  {% set point_y = geographies[org.organisation].lat_long()[1] %}
                  {% set map_id = "map-" + geographies[org.organisation].statistical_geography %}
                  <div id="map-{{geographies[org.organisation].statistical_geography}}" style="height: 45vh;">
                </div>
                  <script>
                    let map_{{ loop.index }} = L.map('{{map_id}}').setView([{{ point_x }}, {{ point_y }}], 11);
                    L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', { attribution: 'OSM' }).addTo(map_{{ loop.index }})
                    L.geoJSON({{geojson}}, {}).addTo(map_{{ loop.index }})
                  </script>
                <div>
                  <input type="hidden" name="geography-reference" value="statistical-geography:{{geographies[org.organisation].statistical_geography}}">

              {% endif %}
            {% endfor %}
            {% for org in development_plan.organisations %}
              {% if not org.geometry %}
                    <p>No geometry found for {{org.name}}</p>
              {% endif %}
            {% endfor %}

          </div>
           <!--<div id="contact-hint" class="govuk-hint">
            Select one option.
          </div>-->
          <div class="govuk-!-margin-top-6">
            <div class="govuk-radios__item">
              <input class="govuk-radios__input" id="geography-provided-1" name="geography-provided" type="radio" value="yes">
              <label class="govuk-label govuk-radios__label" for="geography-provided-1">
                Yes
              </label>
            </div>
            <div class="govuk-radios" data-module="govuk-radios">
              <div class="govuk-radios__item">
                <input class="govuk-radios__input" id="geography-provided-2" name="geography-provided" type="radio" value="no" data-aria-controls="conditional-geography">
                <label class="govuk-label govuk-radios__label" for="geography-provided-2">
                  No
                </label>
              </div>
              <div class="govuk-radios__conditional govuk-radios__conditional--hidden" id="conditional-geography">
                <div class="govuk-form-group">
                  <label class="govuk-label" for="file-upload">
                    Upload shapefile
                  </label>
                  <input class="govuk-file-upload" id="file-upload" name="fileUpload" type="file">
                </div>

                <p class="govuk-body">or</p>

                <div class="govuk-form-group">
                  <label class="govuk-label" for="endpoint">URL to WFS endpoint</label>
                  <input class="govuk-input" id="endpoint" name="endpoint" type="text">
                </div>
              </div>
            </div>
          </div>
        </fieldset>
      </div>



      <div class="govuk-button-group">
        <button class="govuk-button" type="submit">Save and continue</button>
        <a class="govuk-link" href="{{ url_for('development_plan.plan', reference=development_plan.reference) }}">Skip for now</a>
      </div>
    </form>
  </div>
</div>

{% endblock %}

{% block pageScripts %}{% endblock pageScripts %}
